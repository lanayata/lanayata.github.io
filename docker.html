<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>docker组件安装</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="l7w1" id="docker组件安装">docker组件安装</h1><p data-anchor-id="5n2p"><code>docker</code></p><hr><div class="md-section-divider"></div><h2 data-anchor-id="gmvx" id="安装docker服务">安装docker服务</h2><p data-anchor-id="9h31">&nbsp; &nbsp; &nbsp; &nbsp;初始操作系统是centos7，“uname -rs”显示内核如下</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="k6st"><ol class="linenums"><li class="L0"><code><span class="typ">Linux</span><span class="pln"> </span><span class="lit">3.10</span><span class="pun">.</span><span class="lit">0</span><span class="pun">-</span><span class="lit">327.el7.x86</span><span class="pln">_64</span></code></li></ol></pre><p data-anchor-id="nv7i">&nbsp; &nbsp; &nbsp; &nbsp;修改/etc/resolve.conf配置文件,添加如下内容</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="pp5q"><ol class="linenums"><li class="L0"><code><span class="pln">nameserver </span><span class="lit">114.114</span><span class="pun">.</span><span class="lit">114.114</span></code></li><li class="L1"><code><span class="pln">nameserver </span><span class="lit">8.8</span><span class="pun">.</span><span class="lit">8.8</span></code></li></ol></pre><p data-anchor-id="7sk3">&nbsp; &nbsp; &nbsp; &nbsp;预安装工具包</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="0cjz"><ol class="linenums"><li class="L0"><code><span class="pln">sudo yum install </span><span class="pun">-</span><span class="pln">y yum</span><span class="pun">-</span><span class="pln">utils device</span><span class="pun">-</span><span class="pln">mapper</span><span class="pun">-</span><span class="pln">persistent</span><span class="pun">-</span><span class="pln">data lvm2</span></code></li><li class="L1"><code><span class="pln">sudo yum</span><span class="pun">-</span><span class="pln">config</span><span class="pun">-</span><span class="pln">manager </span><span class="pun">--</span><span class="pln">add</span><span class="pun">-</span><span class="pln">repo https</span><span class="pun">:</span><span class="com">//download.docker.com/linux/centos/docker-ce.repo</span></code></li><li class="L2"><code><span class="pln">sudo yum makecache fast</span></code></li></ol></pre><p data-anchor-id="gkuk">&nbsp; &nbsp; &nbsp; &nbsp;安装docker-ce</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="vatm"><ol class="linenums"><li class="L0"><code><span class="pln">sudo yum install docker</span><span class="pun">-</span><span class="pln">ce</span></code></li></ol></pre><p data-anchor-id="uarh">&nbsp; &nbsp; &nbsp; &nbsp;启动docker服务</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="k0uh"><ol class="linenums"><li class="L0"><code><span class="pln">sudo systemctl start docker</span></code></li></ol></pre><p data-anchor-id="7e25">&nbsp; &nbsp; &nbsp; &nbsp;安装docker镜像，选择ubuntu:16.04版本和centos:7.3.1611版本</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="sin9"><ol class="linenums"><li class="L0"><code><span class="pln">docker pull ubuntu</span><span class="pun">:</span><span class="lit">16.04</span></code></li><li class="L1"><code><span class="pln">docker pull centos</span><span class="pun">:</span><span class="lit">7.3</span><span class="pun">.</span><span class="lit">1611</span></code></li></ol></pre><p data-anchor-id="x14n">&nbsp; &nbsp; &nbsp; &nbsp;常用命令</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="tj4a"><ol class="linenums"><li class="L0"><code><span class="com">#显示所有镜像</span></code></li><li class="L1"><code><span class="pln">docker images </span></code></li><li class="L2"><code><span class="com">#显示所有运行的容器</span></code></li><li class="L3"><code><span class="pln">docker ps </span><span class="pun">-</span><span class="pln">a </span></code></li><li class="L4"><code><span class="com">#创建docker网络</span></code></li><li class="L5"><code><span class="pln">docker network create </span><span class="pun">--</span><span class="pln">subnet</span><span class="pun">=</span><span class="lit">172.18</span><span class="pun">.</span><span class="lit">0.0</span><span class="pun">/</span><span class="lit">16</span><span class="pln"> cloud_network </span></code></li><li class="L6"><code><span class="com">#创建容器</span></code></li><li class="L7"><code><span class="com">## -p表示端口映射，12888为物理机段阔，2888为容器端口</span></code></li><li class="L8"><code><span class="com">## --privileged表示使用root权限创建容器</span></code></li><li class="L9"><code><span class="com">## -v表示挂载存储，/home/data/表示物理机存储，/usr/local/data/表示容器存储</span></code></li><li class="L0"><code><span class="com">## --name为docker容器定义名称</span></code></li><li class="L1"><code><span class="com">## --h为定义容器内系统host名称</span></code></li><li class="L2"><code><span class="com">## --net指定容器的网络</span></code></li><li class="L3"><code><span class="com">## --ip指定容器的ip地址</span></code></li><li class="L4"><code><span class="com">## --add-host在hosts文件中指定名称和地址的映射</span></code></li><li class="L5"><code><span class="com">## -it表示给容器分配一个终端方便访问</span></code></li><li class="L6"><code><span class="com">## centos:7.3.1611表示镜像名称</span></code></li><li class="L7"><code><span class="pln">docker create </span><span class="pun">-</span><span class="pln">p </span><span class="lit">12888</span><span class="pun">:</span><span class="lit">2888</span><span class="pln"> </span><span class="pun">--</span><span class="pln">privileged </span><span class="pun">-</span><span class="pln">v </span><span class="pun">/</span><span class="pln">home</span><span class="pun">/</span><span class="pln">data</span><span class="pun">/:</span><span class="str">/usr/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">data</span><span class="pun">/:</span><span class="pln">ro </span><span class="pun">--</span><span class="pln">name cloud1 </span><span class="pun">-</span><span class="pln">h cloud1 </span><span class="pun">--</span><span class="pln">net</span><span class="pun">=</span><span class="pln">cloud_network </span><span class="pun">--</span><span class="pln">ip </span><span class="lit">172.18</span><span class="pun">.</span><span class="lit">0.2</span><span class="pln"> </span><span class="pun">--</span><span class="pln">add</span><span class="pun">-</span><span class="pln">host master</span><span class="pun">:</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">137.129</span><span class="pln"> </span><span class="pun">-</span><span class="pln">it centos</span><span class="pun">:</span><span class="lit">7.3</span><span class="pun">.</span><span class="lit">1611</span></code></li><li class="L8"><code><span class="com">#启动容器</span></code></li><li class="L9"><code><span class="pln">docker start cloud1</span></code></li><li class="L0"><code><span class="com">#进入容器(此方法退出容器时，容器仍运行)</span></code></li><li class="L1"><code><span class="pln">docker </span><span class="kwd">exec</span><span class="pln"> </span><span class="pun">-</span><span class="pln">it cloud1 centos</span><span class="pun">:</span><span class="lit">7.3</span><span class="pun">.</span><span class="lit">1611</span><span class="pln"> </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">bash</span></code></li><li class="L2"><code><span class="com">#创建并启动容器(此方法退出容器时，容器关闭)</span></code></li><li class="L3"><code><span class="pln">docker run </span><span class="pun">-</span><span class="pln">it </span><span class="pun">--</span><span class="pln">privileged centos</span><span class="pun">:</span><span class="lit">7.3</span><span class="pun">.</span><span class="lit">1611</span><span class="pln"> </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">bash</span></code></li><li class="L4"><code><span class="com">#查看容器的ip地址,container_id需要修改为容器的id或名称</span></code></li><li class="L5"><code><span class="pln">docker inspect container_id </span><span class="pun">|</span><span class="pln">grep </span><span class="typ">IPAddress</span></code></li><li class="L6"><code><span class="pln">docker inspect </span><span class="pun">--</span><span class="pln">format</span><span class="pun">=</span><span class="str">'{{.NetworkSettings.IPAddress}}'</span><span class="pln"> container_id</span></code></li><li class="L7"><code><span class="com">#提交容器并生成镜像(不推荐，但可用，推荐使用Dockfile创建镜像)</span></code></li><li class="L8"><code><span class="pln">docker commit contain_id image_name</span></code></li><li class="L9"><code><span class="com">#删除容器,container_id需要修改为容器的id或名称</span></code></li><li class="L0"><code><span class="pln">docker rm container_id</span></code></li><li class="L1"><code><span class="com">#删除镜像,image_id需要修改为镜像的id或名称</span></code></li><li class="L2"><code><span class="pln">docker rmi image_id</span></code></li><li class="L3"><code><span class="com">#保存镜像,方便移植</span></code></li><li class="L4"><code><span class="pln">docker save image_id </span><span class="pun">&gt;</span><span class="pln"> </span><span class="str">/usr/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">storage</span><span class="pun">/</span><span class="pln">image</span><span class="pun">.</span><span class="pln">tar</span></code></li><li class="L5"><code><span class="com">#载入镜像</span></code></li><li class="L6"><code><span class="pln">docker load </span><span class="pun">--</span><span class="pln">input </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">storage</span><span class="pun">/</span><span class="pln">image</span><span class="pun">.</span><span class="pln">tar</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="8jqu" id="安装docker-compose">安装docker-compose</h2><p data-anchor-id="per2">&nbsp; &nbsp; &nbsp; &nbsp;由于直接下载compose工具包安装失败，此处使用镜像安装docker-compose，版本选择1.14.0</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="bqc4"><ol class="linenums"><li class="L0"><code><span class="pln">docker pull docker</span><span class="pun">/</span><span class="pln">compose</span><span class="pun">:</span><span class="lit">1.14</span><span class="pun">.</span><span class="lit">0</span></code></li><li class="L1"><code><span class="pln">curl </span><span class="pun">-</span><span class="pln">L </span><span class="pun">--</span><span class="pln">fail https</span><span class="pun">:</span><span class="com">//github.com/docker/compose/releases/download/1.14.0/run.sh &gt; /usr/local/bin/docker-compose-install</span></code></li><li class="L2"><code><span class="pln">chmod u</span><span class="pun">+</span><span class="pln">x docker</span><span class="pun">-</span><span class="pln">compose</span><span class="pun">-</span><span class="pln">install</span></code></li><li class="L3"><code><span class="pln">cd </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">./</span><span class="pln">docker</span><span class="pun">-</span><span class="pln">compose</span><span class="pun">-</span><span class="pln">install</span></code></li><li class="L4"><code><span class="com">#测试是否安装成功</span></code></li><li class="L5"><code><span class="pln">docker</span><span class="pun">-</span><span class="pln">compose</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="7kd4" id="安装docker-machine">安装docker-machine</h2><p data-anchor-id="p0pc">&nbsp; &nbsp; &nbsp; &nbsp;docker-machine无镜像，使用工具包安装</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="etas"><ol class="linenums"><li class="L0"><code><span class="pln">curl </span><span class="pun">-</span><span class="pln">L https</span><span class="pun">:</span><span class="com">//github.com/docker/machine/releases/download/v0.12.2/docker-machine-`uname -s`-`uname -m` &gt;/tmp/dockermachine &amp;&amp; chmod +x /tmp/docker-machine &amp;&amp; sudo cp /tmp/docker-machine /usr/local/bin/docker-machine</span></code></li></ol></pre></div>
</body>
</html>